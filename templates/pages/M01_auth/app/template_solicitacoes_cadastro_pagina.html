{% extends 'pages/M01_auth/template_base_auth.html' %}

{% block title %}Solicitações de Cadastro | SIGMA-PLI{% endblock %}

{% block extra_head %}
<style>
  .metric-card {
    border-radius: 12px;
    border: 1px solid rgba(77, 166, 255, 0.3);
    background: rgba(22, 42, 72, 0.9);
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  .metric-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 24px rgba(77, 166, 255, 0.2);
    border-color: rgba(77, 166, 255, 0.6);
  }
  .metric-card h6 {
    color: #8b98a5;
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }
  .metric-card h3 {
    color: #4da6ff;
    font-size: 2rem;
    font-weight: 700;
    margin: 0;
  }
  .metric-icon {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.2;
  }
  .metric-icon i {
    font-size: 1.8rem;
    color: white;
  }
  .bg-primary { background: linear-gradient(135deg, #4da6ff, #0066cc); }
  .bg-warning { background: linear-gradient(135deg, #ffc107, #e0a800); }
  .bg-success { background: linear-gradient(135deg, #28a745, #1e7e34); }
  .bg-danger { background: linear-gradient(135deg, #dc3545, #c82333); }
  
  .card {
    background: rgba(22, 42, 72, 0.9);
    border: 1px solid rgba(77, 166, 255, 0.3);
    border-radius: 12px;
  }
  .card-header {
    background: rgba(77, 166, 255, 0.1);
    border-bottom: 1px solid rgba(77, 166, 255, 0.3);
    color: #4da6ff;
    font-weight: 600;
  }
  .table {
    color: #e0e6ed;
  }
  .table thead th {
    background: rgba(77, 166, 255, 0.1);
    border-color: rgba(77, 166, 255, 0.3);
    color: #4da6ff;
  }
  .table tbody tr:hover {
    background: rgba(77, 166, 255, 0.05);
  }
  .modal-content {
    background: linear-gradient(135deg, #0b1729 0%, #162a48 100%);
    border: 1px solid rgba(77, 166, 255, 0.3);
  }
  .modal-header {
    border-bottom: 1px solid rgba(77, 166, 255, 0.3);
  }
  .modal-footer {
    border-top: 1px solid rgba(77, 166, 255, 0.3);
  }
  
  /* Timeline */
  .timeline {
    position: relative;
    padding: 1rem 0;
  }
  .timeline-item {
    position: relative;
    padding-left: 40px;
    padding-bottom: 1.5rem;
  }
  .timeline-item:last-child {
    padding-bottom: 0;
  }
  .timeline-item::before {
    content: '';
    position: absolute;
    left: 10px;
    top: 0;
    bottom: -1.5rem;
    width: 2px;
    background: rgba(77, 166, 255, 0.3);
  }
  .timeline-item:last-child::before {
    display: none;
  }
  .timeline-marker {
    position: absolute;
    left: 0;
    top: 0;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 3px solid;
    background: #0b1729;
  }
  .timeline-marker.status-pendente {
    border-color: #ffc107;
  }
  .timeline-marker.status-analise {
    border-color: #17a2b8;
  }
  .timeline-marker.status-aprovado {
    border-color: #28a745;
  }
  .timeline-marker.status-rejeitado {
    border-color: #dc3545;
  }
  .timeline-content {
    padding: 0.75rem;
    background: rgba(77, 166, 255, 0.05);
    border-radius: 8px;
    border-left: 3px solid rgba(77, 166, 255, 0.3);
  }
  .timeline-date {
    color: #8b98a5;
    font-size: 0.875rem;
  }
  
  /* Badges de status melhorados */
  .status-badge {
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.875rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }
  .status-badge i {
    font-size: 0.75rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="pli-main-content">
  <main class="container-fluid py-4">
    <!-- Cabeçalho -->
    <div class="row mb-4">
      <div class="col-12 d-flex justify-content-between align-items-center">
        <div>
          <h1 class="h3 mb-1">
            <i class="fas fa-clipboard-list text-primary"></i>
            Solicitações de Cadastro
          </h1>
          <p class="text-muted mb-0">Gerencie e acompanhe solicitações de cadastro no sistema</p>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-success" id="btnExportar">
            <i class="fas fa-file-excel me-2"></i>Exportar
          </button>
          <button class="btn btn-primary" id="btnAtualizar">
            <i class="fas fa-sync-alt me-2"></i>Atualizar
          </button>
        </div>
      </div>
    </div>

    <!-- Métricas -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card metric-card border-primary">
          <div class="card-body">
            <h6>Total de Solicitações</h6>
            <h3 id="totalSolicitacoes">-</h3>
            <div class="metric-icon bg-primary">
              <i class="fas fa-clipboard-list"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card metric-card border-warning">
          <div class="card-body">
            <h6>Pendentes</h6>
            <h3 id="solicitacoesPendentes">-</h3>
            <div class="metric-icon bg-warning">
              <i class="fas fa-clock"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card metric-card border-success">
          <div class="card-body">
            <h6>Aprovadas</h6>
            <h3 id="solicitacoesAprovadas">-</h3>
            <div class="metric-icon bg-success">
              <i class="fas fa-check-circle"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card metric-card border-danger">
          <div class="card-body">
            <h6>Rejeitadas</h6>
            <h3 id="solicitacoesRejeitadas">-</h3>
            <div class="metric-icon bg-danger">
              <i class="fas fa-times-circle"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filtros Avançados -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-filter"></i> Filtros de Busca</h5>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-3">
                <label class="form-label" for="filtroProtocolo">Protocolo</label>
                <input class="form-control" id="filtroProtocolo" placeholder="2024/00123" type="text">
              </div>
              <div class="col-md-3">
                <label class="form-label" for="filtroSolicitante">Solicitante</label>
                <input class="form-control" id="filtroSolicitante" placeholder="Nome do solicitante" type="text">
              </div>
              <div class="col-md-2">
                <label class="form-label" for="filtroTipo">Tipo</label>
                <select class="form-select" id="filtroTipo">
                  <option value="">Todos</option>
                  <option value="PF">Pessoa Física</option>
                  <option value="PJ">Pessoa Jurídica</option>
                  <option value="USUARIO">Novo Usuário</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label" for="filtroStatus">Status</label>
                <select class="form-select" id="filtroStatus">
                  <option value="">Todos</option>
                  <option value="pendente">Pendente</option>
                  <option value="em_analise">Em Análise</option>
                  <option value="aprovado">Aprovado</option>
                  <option value="rejeitado">Rejeitado</option>
                </select>
              </div>
              <div class="col-md-2 d-flex align-items-end">
                <div class="w-100">
                  <button class="btn btn-primary w-100" id="btnBuscar">
                    <i class="fas fa-search me-2"></i>Buscar
                  </button>
                </div>
              </div>
              <div class="col-md-12">
                <button class="btn btn-secondary btn-sm" id="btnLimpar">
                  <i class="fas fa-times me-2"></i>Limpar Filtros
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabela -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-table"></i> Lista de Solicitações</h5>
            <span class="text-muted" id="totalRegistros">0 registros</span>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped table-hover" id="solicitacoesTable">
                <thead>
                  <tr>
                    <th>Protocolo</th>
                    <th>Data</th>
                    <th>Solicitante</th>
                    <th>Tipo</th>
                    <th>Documento</th>
                    <th>Status</th>
                    <th>Responsável</th>
                    <th width="180">Ações</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="8" class="text-center text-muted">
                      <i class="fas fa-spinner fa-spin me-2"></i>Carregando dados...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!-- Paginação -->
            <div class="d-flex justify-content-between align-items-center mt-3">
              <div class="text-muted">
                Mostrando <span id="showingStart">0</span> a <span id="showingEnd">0</span> de <span id="showingTotal">0</span> registros
              </div>
              <nav>
                <ul class="pagination mb-0" id="pagination"></ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>
</div>

<!-- Modal Detalhes e Aprovação COMPLETO -->
<div class="modal fade" id="solicitacaoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-file-alt me-2 text-primary"></i>
          Detalhes da Solicitação
        </h5>
        <button class="btn-close" data-bs-dismiss="modal" aria-label="Fechar" type="button"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          
          <!-- Coluna Esquerda: Dados da Solicitação -->
          <div class="col-md-7">
            <!-- Informações Gerais -->
            <div class="card mb-3">
              <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-info-circle"></i> Informações Gerais</h6>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-6">
                    <strong>Protocolo:</strong>
                    <p class="mb-0" id="detProtocolo">-</p>
                  </div>
                  <div class="col-md-6">
                    <strong>Data da Solicitação:</strong>
                    <p class="mb-0" id="detData">-</p>
                  </div>
                  <div class="col-md-6">
                    <strong>Tipo:</strong>
                    <p class="mb-0" id="detTipo">-</p>
                  </div>
                  <div class="col-md-6">
                    <strong>Status Atual:</strong>
                    <p class="mb-0" id="detStatus">-</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Dados do Solicitante -->
            <div class="card mb-3">
              <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-user"></i> Dados do Solicitante</h6>
              </div>
              <div class="card-body">
                <div class="row g-3">
                  <div class="col-md-12">
                    <strong>Nome/Razão Social:</strong>
                    <p class="mb-0" id="detNome">-</p>
                  </div>
                  <div class="col-md-6">
                    <strong>CPF/CNPJ:</strong>
                    <p class="mb-0" id="detDocumento">-</p>
                  </div>
                  <div class="col-md-6">
                    <strong>E-mail:</strong>
                    <p class="mb-0" id="detEmail">-</p>
                  </div>
                  <div class="col-md-6">
                    <strong>Telefone:</strong>
                    <p class="mb-0" id="detTelefone">-</p>
                  </div>
                  <div class="col-md-6">
                    <strong>Celular:</strong>
                    <p class="mb-0" id="detCelular">-</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Observações -->
            <div class="card">
              <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-comment"></i> Observações</h6>
              </div>
              <div class="card-body">
                <p class="mb-0" id="detObservacoes">Nenhuma observação registrada.</p>
              </div>
            </div>
          </div>

          <!-- Coluna Direita: Timeline e Ações -->
          <div class="col-md-5">
            <!-- Timeline do Processo -->
            <div class="card mb-3">
              <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-history"></i> Histórico do Processo</h6>
              </div>
              <div class="card-body">
                <div class="timeline" id="timeline">
                  <!-- Timeline será preenchida dinamicamente -->
                </div>
              </div>
            </div>

            <!-- Ações de Aprovação -->
            <div class="card">
              <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-tasks"></i> Ações</h6>
              </div>
              <div class="card-body">
                <form id="acaoForm">
                  <div class="mb-3">
                    <label class="form-label" for="acaoTipo">Ação *</label>
                    <select class="form-select" id="acaoTipo" required>
                      <option value="">Selecione uma ação</option>
                      <option value="analisar">Colocar em Análise</option>
                      <option value="aprovar">Aprovar Solicitação</option>
                      <option value="rejeitar">Rejeitar Solicitação</option>
                      <option value="solicitar_info">Solicitar Informações</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="acaoJustificativa">Justificativa/Observações *</label>
                    <textarea class="form-control" id="acaoJustificativa" rows="4" required></textarea>
                    <div class="form-text">Descreva o motivo da decisão ou informações adicionais necessárias</div>
                  </div>
                  <div class="d-grid gap-2">
                    <button class="btn btn-primary" type="submit">
                      <i class="fas fa-paper-plane me-2"></i>Executar Ação
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>

        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">
          <i class="fas fa-times me-2"></i>Fechar
        </button>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Dados mockados com histórico completo
const solicitacoesMock = [
  {
    id: 1,
    protocolo: '2024/00123',
    data: '2024-10-15 10:30:00',
    solicitante: 'João Silva Santos',
    tipo: 'PF',
    documento: '123.456.789-00',
    email: 'joao.silva@email.com',
    telefone: '(11) 3456-7890',
    celular: '(11) 98765-4321',
    status: 'pendente',
    responsavel: '-',
    observacoes: 'Solicitação de cadastro para acesso ao sistema PLI.',
    historico: [
      { data: '2024-10-15 10:30', acao: 'Solicitação Criada', responsavel: 'Sistema', status: 'pendente' }
    ]
  },
  {
    id: 2,
    protocolo: '2024/00124',
    data: '2024-10-16 14:20:00',
    solicitante: 'Tech Solutions Ltda',
    tipo: 'PJ',
    documento: '12.345.678/0001-90',
    email: 'contato@techsol.com.br',
    telefone: '(11) 3456-7890',
    celular: '(11) 98765-4321',
    status: 'em_analise',
    responsavel: 'Maria Oliveira',
    observacoes: 'Empresa solicitando acesso para gestão de projetos.',
    historico: [
      { data: '2024-10-16 14:20', acao: 'Solicitação Criada', responsavel: 'Sistema', status: 'pendente' },
      { data: '2024-10-17 09:15', acao: 'Em Análise', responsavel: 'Maria Oliveira', status: 'em_analise' }
    ]
  },
  {
    id: 3,
    protocolo: '2024/00125',
    data: '2024-10-17 11:00:00',
    solicitante: 'Ana Paula Costa',
    tipo: 'USUARIO',
    documento: '987.654.321-00',
    email: 'ana.costa@email.com',
    telefone: '',
    celular: '(21) 99876-5432',
    status: 'aprovado',
    responsavel: 'Carlos Santos',
    observacoes: 'Novo usuário do departamento de RH.',
    historico: [
      { data: '2024-10-17 11:00', acao: 'Solicitação Criada', responsavel: 'Sistema', status: 'pendente' },
      { data: '2024-10-17 14:30', acao: 'Em Análise', responsavel: 'Carlos Santos', status: 'em_analise' },
      { data: '2024-10-18 10:00', acao: 'Aprovado', responsavel: 'Carlos Santos', status: 'aprovado' }
    ]
  },
  {
    id: 4,
    protocolo: '2024/00126',
    data: '2024-10-18 16:45:00',
    solicitante: 'Pedro Souza Lima',
    tipo: 'PF',
    documento: '456.789.123-00',
    email: 'pedro.souza@email.com',
    telefone: '(31) 3344-5566',
    celular: '(31) 97654-3210',
    status: 'rejeitado',
    responsavel: 'Maria Oliveira',
    observacoes: 'Documentação incompleta.',
    historico: [
      { data: '2024-10-18 16:45', acao: 'Solicitação Criada', responsavel: 'Sistema', status: 'pendente' },
      { data: '2024-10-19 09:00', acao: 'Em Análise', responsavel: 'Maria Oliveira', status: 'em_analise' },
      { data: '2024-10-19 11:30', acao: 'Rejeitado - Documentação incompleta', responsavel: 'Maria Oliveira', status: 'rejeitado' }
    ]
  }
];

// Carregar métricas
function carregarMetricas() {
  document.getElementById('totalSolicitacoes').textContent = solicitacoesMock.length;
  document.getElementById('solicitacoesPendentes').textContent = solicitacoesMock.filter(s => s.status === 'pendente').length;
  document.getElementById('solicitacoesAprovadas').textContent = solicitacoesMock.filter(s => s.status === 'aprovado').length;
  document.getElementById('solicitacoesRejeitadas').textContent = solicitacoesMock.filter(s => s.status === 'rejeitado').length;
}

// Formatar data
function formatarData(data) {
  return new Date(data).toLocaleString('pt-BR');
}

// Badge de status
function getBadgeStatus(status) {
  const badges = {
    'pendente': '<span class="status-badge bg-warning text-dark"><i class="fas fa-clock"></i> Pendente</span>',
    'em_analise': '<span class="status-badge bg-info text-white"><i class="fas fa-search"></i> Em Análise</span>',
    'aprovado': '<span class="status-badge bg-success text-white"><i class="fas fa-check"></i> Aprovado</span>',
    'rejeitado': '<span class="status-badge bg-danger text-white"><i class="fas fa-times"></i> Rejeitado</span>'
  };
  return badges[status] || status;
}

// Tipo de solicitação
function getTipoLabel(tipo) {
  const tipos = {
    'PF': 'Pessoa Física',
    'PJ': 'Pessoa Jurídica',
    'USUARIO': 'Novo Usuário'
  };
  return tipos[tipo] || tipo;
}

// Carregar tabela
function carregarTabela(dados = solicitacoesMock) {
  const tbody = document.querySelector('#solicitacoesTable tbody');
  
  if (dados.length === 0) {
    tbody.innerHTML = '<tr><td colspan="8" class="text-center text-muted">Nenhuma solicitação encontrada</td></tr>';
    return;
  }
  
  tbody.innerHTML = dados.map(sol => `
    <tr>
      <td><strong>${sol.protocolo}</strong></td>
      <td>${formatarData(sol.data)}</td>
      <td>${sol.solicitante}</td>
      <td><span class="badge bg-secondary">${getTipoLabel(sol.tipo)}</span></td>
      <td>${sol.documento}</td>
      <td>${getBadgeStatus(sol.status)}</td>
      <td>${sol.responsavel}</td>
      <td>
        <button class="btn btn-sm btn-primary" onclick="visualizarSolicitacao(${sol.id})" title="Visualizar">
          <i class="fas fa-eye"></i>
        </button>
        <button class="btn btn-sm btn-success" onclick="aprovarRapido(${sol.id})" title="Aprovar" ${sol.status !== 'pendente' && sol.status !== 'em_analise' ? 'disabled' : ''}>
          <i class="fas fa-check"></i>
        </button>
        <button class="btn btn-sm btn-danger" onclick="rejeitarRapido(${sol.id})" title="Rejeitar" ${sol.status !== 'pendente' && sol.status !== 'em_analise' ? 'disabled' : ''}>
          <i class="fas fa-times"></i>
        </button>
      </td>
    </tr>
  `).join('');
  
  document.getElementById('totalRegistros').textContent = `${dados.length} registro${dados.length !== 1 ? 's' : ''}`;
}

// Visualizar solicitação
function visualizarSolicitacao(id) {
  const sol = solicitacoesMock.find(s => s.id === id);
  if (!sol) return;
  
  // Preencher dados gerais
  document.getElementById('detProtocolo').textContent = sol.protocolo;
  document.getElementById('detData').textContent = formatarData(sol.data);
  document.getElementById('detTipo').innerHTML = `<span class="badge bg-secondary">${getTipoLabel(sol.tipo)}</span>`;
  document.getElementById('detStatus').innerHTML = getBadgeStatus(sol.status);
  
  // Dados do solicitante
  document.getElementById('detNome').textContent = sol.solicitante;
  document.getElementById('detDocumento').textContent = sol.documento;
  document.getElementById('detEmail').textContent = sol.email;
  document.getElementById('detTelefone').textContent = sol.telefone || '-';
  document.getElementById('detCelular').textContent = sol.celular || '-';
  document.getElementById('detObservacoes').textContent = sol.observacoes;
  
  // Renderizar timeline
  const timeline = document.getElementById('timeline');
  timeline.innerHTML = sol.historico.map(h => `
    <div class="timeline-item">
      <div class="timeline-marker status-${h.status}"></div>
      <div class="timeline-content">
        <strong>${h.acao}</strong>
        <p class="mb-1">Por: ${h.responsavel}</p>
        <p class="timeline-date mb-0">${formatarData(h.data)}</p>
      </div>
    </div>
  `).join('');
  
  // Armazenar ID atual
  document.getElementById('acaoForm').dataset.solicitacaoId = id;
  
  new bootstrap.Modal(document.getElementById('solicitacaoModal')).show();
}

// Aprovar rápido
function aprovarRapido(id) {
  if (confirm('Tem certeza que deseja aprovar esta solicitação?')) {
    alert('Solicitação aprovada com sucesso!');
    carregarTabela();
  }
}

// Rejeitar rápido
function rejeitarRapido(id) {
  const motivo = prompt('Informe o motivo da rejeição:');
  if (motivo) {
    alert('Solicitação rejeitada!');
    carregarTabela();
  }
}

// Form de ação
document.getElementById('acaoForm')?.addEventListener('submit', function(e) {
  e.preventDefault();
  
  if (!this.checkValidity()) {
    e.stopPropagation();
    this.classList.add('was-validated');
    return;
  }
  
  const acao = document.getElementById('acaoTipo').value;
  const justificativa = document.getElementById('acaoJustificativa').value;
  
  alert(`Ação "${acao}" executada com sucesso!\nJustificativa: ${justificativa}`);
  
  bootstrap.Modal.getInstance(document.getElementById('solicitacaoModal')).hide();
  this.reset();
  this.classList.remove('was-validated');
  carregarTabela();
});

// Limpar form ao fechar modal
document.getElementById('solicitacaoModal')?.addEventListener('hidden.bs.modal', function() {
  document.getElementById('acaoForm').reset();
  document.getElementById('acaoForm').classList.remove('was-validated');
});

// Buscar
document.getElementById('btnBuscar')?.addEventListener('click', function() {
  const protocolo = document.getElementById('filtroProtocolo').value.toLowerCase();
  const solicitante = document.getElementById('filtroSolicitante').value.toLowerCase();
  const tipo = document.getElementById('filtroTipo').value;
  const status = document.getElementById('filtroStatus').value;
  
  const filtrados = solicitacoesMock.filter(sol => {
    return (!protocolo || sol.protocolo.toLowerCase().includes(protocolo)) &&
           (!solicitante || sol.solicitante.toLowerCase().includes(solicitante)) &&
           (!tipo || sol.tipo === tipo) &&
           (!status || sol.status === status);
  });
  
  carregarTabela(filtrados);
});

// Limpar
document.getElementById('btnLimpar')?.addEventListener('click', function() {
  document.getElementById('filtroProtocolo').value = '';
  document.getElementById('filtroSolicitante').value = '';
  document.getElementById('filtroTipo').value = '';
  document.getElementById('filtroStatus').value = '';
  carregarTabela();
});

// Atualizar
document.getElementById('btnAtualizar')?.addEventListener('click', function() {
  const icon = this.querySelector('i');
  icon.classList.add('fa-spin');
  setTimeout(() => {
    carregarMetricas();
    carregarTabela();
    icon.classList.remove('fa-spin');
    alert('Dados atualizados!');
  }, 1000);
});

// Exportar
document.getElementById('btnExportar')?.addEventListener('click', function() {
  alert('Exportando solicitações para Excel...');
});

// Inicializar
document.addEventListener('DOMContentLoaded', function() {
  carregarMetricas();
  carregarTabela();
});
</script>
{% endblock %}
